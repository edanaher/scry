DROP SCHEMA IF EXISTS scry CASCADE;
CREATE SCHEMA scry;
SET search_path = scry;

CREATE TABLE authors (
  id int8 GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name text NOT NULL
);


CREATE TABLE books (
  id int8 GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title text NOT NULL,
  year int8 NOT NULL,
  author_id int8 REFERENCES authors (id)
);

CREATE TABLE genres (
  id int8 GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name text NOT NULL
);

CREATE TABLE books_genres (
  book_id int8 REFERENCES books (id),
  genre_id int8 REFERENCES genres (id)
);

CREATE TABLE series (
  id int8 GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name text NOT NULL
);

CREATE TABLE series_books (
  series_id int8 REFERENCES series (id),
  book_id int8 REFERENCES books (id)
);

CREATE TABLE users (
  id int8 GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name text NOT NULL
);

CREATE TABLE favorites (
  user_id int8 REFERENCES users (id),
  book_id int8 REFERENCES books (id),
  reason text NOT NULL,
  PRIMARY KEY (user_id, book_id)
);


INSERT INTO authors (id, name) VALUES
  (1, 'J.R.R Tokien'),
  (2, 'J.K. Rowling'),
  (3, 'Ted Chaing');

INSERT INTO books (id, title, year, author_id) VALUES
  (1, 'Fellowship of the Rings', 1950, 1),
  (2, 'The Two Towers', 1953, 1),
  (3, 'Return of the King', 1956, 1),
  (4, 'Harry Potter and the Philosopher''s Stone', 1994, 2),
  (5, 'Harry Potter and the Prisoner of Azkaban', 1996, 2),

  (6, 'Exhalation', 2017, 3),

  (7, 'Beowolf', 2016, 1);


INSERT INTO series (id, name) VALUES
  (1, 'Lord of the Rings'),
  (2, 'Harry Potter');

INSERT INTO series_books (series_id, book_id) VALUES
  (1, 1),
  (1, 2),
  (1, 3),
  (2, 4),
  (2, 5);

INSERT INTO genres (id, name) VALUES
  (1, 'Fantasy'),
  (2, 'Science Fiction');

INSERT INTO books_genres (book_id, genre_id) VALUES
  (1, 1),
  (2, 1),
  (3, 1),
  (4, 1),
  (5, 1),
  (6, 2);

INSERT INTO users (id, name) VALUES
  (1, 'Winnie the Pooh'),
  (2, 'Tigger'),
  (3, 'Piglet');

INSERT INTO favorites (user_id, book_id, reason) VALUES
  (1, 4, 'Short and fun'),
  (1, 5, 'Long but still good'),
  (2, 4, 'The only good book in the series'),
  (2, 6, 'Short stories are awesome');
